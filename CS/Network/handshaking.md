# [Network](https://github.com/hyojaekim/TIL/tree/master/Network) / [π  Home](https://github.com/hyojaekim/TIL)

### 3way handshake & 4way handshake

TCPμ μ •ν™•ν• μ „μ†΅μ„ μ„ν•΄ μ—°κ²°μ„ μ„±λ¦½, ν•΄μ  ν•λ” κ³Όμ •μ„ 3way handshake & 4way handshakeλΌκ³  ν•λ‹¤.

### 3way handshake (μ—°κ²° μ„±λ¦½)

![3-way](./img/handshake/3-way.png)

1. μ„λ²„μ—κ² μ ‘μ†μ„ μ”μ²­ν•λ” SYN(M) ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤. μ΄λ• (M)μ€ μ‹ν€€μ¤ λ„λ²„λ¥Ό λ»ν•λ©° λλ¤ μ«μλ¥Ό μλ―Έν•λ‹¤.

2. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ SYN(M)μ„ λ°›κ³ , μ”μ²­μ„ μλ½ν•λ‹¤λ” ACK(M + 1)κ³Ό SYN(N)μ„ λ³΄λ‚΄κ² λλ‹¤. (M + 1)μ€ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ³΄λ‚Έ μ¤ν€€μ¤ λ„λ²„μ— +1μ„ ν•λ‹¤λ” μλ―Έμ΄κ³ , (N)μ€ μƒλ΅μ΄ λλ¤ μ«μλ¥Ό μλ―Έν•λ‹¤.

3. ν΄λΌμ΄μ–ΈνΈλ” ACK(M + 1)μ™€ SYN(N) ν¨ν‚·μ„ λ°›κ³ , ACK(N + 1)λ¥Ό μ„λ²„λ΅ λ³΄λ‚΄λ©΄ μ—°κ²°μ΄ μ„±λ¦½λλ‹¤.

### 4way handshake (μ—°κ²° ν•΄μ )

![4-way](./img/handshake/4-way.png)

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅ μ—°κ²°μ„ μΆ…λ£ν•κ² λ‹¤λ” FIN ν”λκ·Έλ¥Ό λ³΄λ‚Έλ‹¤.

2. μ„λ²„λ” FIN ν”λκ·Έλ¥Ό λ°›κ³ , μ•κ² λ‹¤λ” ACKλ¥Ό λ³΄λ‚Έλ‹¤.

    * μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό λ¨λ‘ μ „μ†΅ν•  λ•κΉμ§€ TIME-OUTμ΄ λλ‹¤.

4. λ°μ΄ν„°λ¥Ό λ¨λ‘ λ³΄λ‚΄κ³ , μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ—κ² FIN ν”λκ·Έλ¥Ό λ³΄λ‚Έλ‹¤.

5. ν΄λΌμ΄μ–ΈνΈλ” FIN ν”λκ·Έλ¥Ό λ°›κ³ , ACKλ¥Ό λ³΄λ‚Έλ‹¤.

    * μ„λ²„λ” ACKλ¥Ό λ°›κ³ , μ†μΌ“ μ—°κ²°μ„ Close ν•λ‹¤.

    * ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„λ΅λ¶€ν„° λ°›μ§€ λ»ν• λ°μ΄ν„°κ°€ μμ„ μ μμΌλ―€λ΅, μΌμ • μ‹κ°„ μ„Έμ…μ„ λ‚¨κ²¨λ‘κ³ , μ‰μ—¬ ν¨ν‚·μ„ κΈ°λ‹¤λ¦°λ‹¤.(TIME-WAIT)

### Packet

TCP ν—¤λ”μ—λ” Flag Bit(Code Bit)κ°€ μ΅΄μ¬ν•λ‹¤. 6Bitλ΅ μ΄λ£¨μ–΄μ Έ μλ‹¤.(000000) ν•΄λ‹Ή λΉ„νΈλ” Urg,Ack,Psh,Rst,Syn,Fin μμ„λ΅ μ΄λ£¨μ–΄μ Έ μλ‹¤.

### Sequence numberκ°€ λ‚μμΈ μ΄μ ?

μ»¤λ„¥μ…μ„ λ§Ίμ„λ• ν¬νΈλ” μ¬μ‚¬μ©λλ‹¤. μ„λ²„λ” ν¨ν‚·μ SYNμ„ λ³΄κ³  κµ¬λ¶„ν•λ”λ° λ‚μκ°€ μ•„λ‹λΌλ©΄, μ΄μ „ μ»¤λ„¥μ…μΌλ΅ μ¤λ” ν¨ν‚·μΌλ΅ μΈμ‹ν•  μ μλ‹¤. λ”°λΌμ„ μ΄λ¬ν• λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ‚μλ΅ μ„¤μ •ν•λ‹¤.

### [λ§¨ μ„λ΅ μ΄λ™](https://github.com/hyojaekim/TIL/blob/master/Network/handshake.md#Network---home)

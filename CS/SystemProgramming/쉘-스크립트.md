# 쉘 스크립트

*서버 작업 자동화 및 운영(DevOps)을 위해 기본적으로 익혀둘 필요가 있다.*

## # 쉘 스크립트 사용 예시

- 로그를 저장하고자 했음.
- 서버의 저장공간이 없음.
- 서버 다운.
- 어떻게 하면 자동으로 오래된 로그 파일을 삭제할까?
- 간단한 쉘스크립트 생성 및 주기적 실행하여 해결

## # 기본 문법

- 쉘 스크립트는 파일로 작성 후, 실행 (실행 권한 필요)
- 파일의 첫 라인은 `#!/bin/bash`로 시작
- 일반적으로 `파일이름.sh`와 같은 형태

![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8bf0458d-f3c5-4315-9eb1-f9a0166324a7/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/8bf0458d-f3c5-4315-9eb1-f9a0166324a7/Untitled.png)

## # 변수

- 주의! `변수명=데이터` 사이에 띄어쓰기를 허용하지 않는다.
- `$변수명` 으로 변수를 사용한다.

## # 배열

- 선언 : `변수명=(A B C)`
- 사용 : `${변수명[인덱스번호]}`

```bash
#!/bin/bash

daemons=("A" "B" "C")
echo ${daemons[1]} //인덱스(1) 해당하는 B를 출력
echo ${daemons[@]} //배열의 모든 데이터 출력
echo ${daemons[*]} //배열의 모든 데이터 출력
echo ${#daemons[@]} //배열의 크기 출력
```

## # 사전에 정의된 지역 변수

- `$$` : 쉘의 프로세스 번호(pid)
- `$0` : 쉘 스크립트 이름
- `$1 ~ $9` : 명령줄 인수
- `$*` : 모든 명령줄 인수 리스트
- `$#` : 인수의 개수
- `$?` : 최근 실행한 명령어의 종료 값
(0 성공, 1 ~ 125 에러, 126 파일 실행 불가, 128 ~ 255 시그널 발생)

## # 연산자

- `expr` : 숫자 계산
- `expr`를 사용하는 경우 역작은 ``` 를 사용해야 한다.
- 연사자 `*` 와 괄호 `()` 앞에는 역슬래시와 같이 사용한다. ( `\*`, `\(`, `\)` )
- 연산자와 숫자, 변수, 기호 사이에는 `space`를 추가해야 함.

```bash
num=`expr \( 10 + 20 \) / 8 - 8`
echo $num //-5
```

## # 조건문 문법

- 기본 if 구문 : 명령문을 꼭 탭으로 띄워야 하는 것은 아니다. (`then`과 `fi` 안에만 들어가 있으면 가능)

```bash
if [ 조건 ]
then
	~~ 명령문 ~~
fi
```

- 인자 2개를 받아 다른지 확인하는 로직

```bash
#!/bin/bash

if [ $1 != $2 ]
then
	echo "different values"
	exit //생략 가능
fi
```

- `-z 문자` : 문자가 null이면 참
- `-n 문자` : 문자가 null이 아니면 참
- `<, >`는 if 조건시 `[[]]`를 넣는 경우 돌아가지만, 다음 문법을 사용하는 것을 권장한다.
    - `A -eq B` : 값이 같음
    - `A -ne B` : 값이 같지 않음
    - `A -lt B` : A가 B보다 작음
    - `A -le B` : A가 B보다 작거나 같음
    - `A -gt B` : A가 B보다 큼
    - `A -ge B` : A가 B보다 크거나 같음
- A가 B보다 큰 경우 출력한다.

```bash
#!/bin/bash

a=$1
b=$2

if [ $a -gt $b ]
then
	echo $a
	exit
fi
```
